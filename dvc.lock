schema: '2.0'
stages:
  preprocess:
    cmd: python src/preprocess.py
    deps:
    - path: ../LoadTraces/spec06/473.astar-s1.txt.xz
      md5: fc15414dd9ef7e04f2fda20bd459cef2
      size: 31279168
    - path: src/data_loader.py
      md5: 4c9a609303cf8083e09b98317235dd7d
      size: 1421
    - path: src/preprocess.py
      md5: 382bc84ee0fe32fa3c8c77d439c6950b
      size: 8832
      isexec: true
    params:
      params.yaml:
        apps.app: 473.astar-s1.txt.xz
        hardware:
          block-bits: 6
          total-bits: 64
          look-back: 9
          pred-forward: 128
          page-bits: 12
          delta-bound: 128
          split-bits: 6
          filter-size: 16
          bitmap-size: 256
          block-num-bits: 58
        system:
          gpu-id: 0
          traces: ../LoadTraces/spec06
          processed: processed
          model: model
        teacher.number: 5
        trace-data:
          train: 2
          total: 3
          skip: 1
          batch-size: 256
    outs:
    - path: processed/df_test_1.pt
      md5: 5330d3d725bc241da0493411ecca02e7
      size: 3363635
    - path: processed/df_test_2.pt
      md5: 33cbbdf3f050f5ea45e4e770b8d7fe75
      size: 65040307
    - path: processed/df_test_3.pt
      md5: 913c8f5c196130441e59cbf369fc1166
      size: 13639923
    - path: processed/df_test_4.pt
      md5: dcf520d6ea756bc40f2f8492a19bbe59
      size: 10817459
    - path: processed/df_test_5.pt
      md5: 87926061b0daee9f3ee35a3c6f08e137
      size: 3636915
    - path: processed/df_test_stu.pt
      md5: 9f254a023ef6536a8eca22cb23f62831
      size: 95502519
    - path: processed/test_loader_1.pt
      md5: 7abb6a8ffa8c6b0fe17391e6e2c88c53
      size: 3677307
    - path: processed/test_loader_2.pt
      md5: 03c425b835c1b667f828e0f00bcb20fb
      size: 71425851
    - path: processed/test_loader_3.pt
      md5: 8b5b4a699cfde5d396311b3982ceb787
      size: 14950395
    - path: processed/test_loader_4.pt
      md5: 69b275b1d21392b17ebef3d3c01d4a96
      size: 11850427
    - path: processed/test_loader_5.pt
      md5: 356190fcaf1f05d24f7b2b4ed6936236
      size: 3977915
    - path: processed/test_loader_stu.pt
      md5: 5b6ed2d01fa6580506f03f77894d26bb
      size: 104891071
    - path: processed/train_loader_1.pt
      md5: 41264025282d375788607e368f3b7c7e
      size: 10040509
    - path: processed/train_loader_2.pt
      md5: a3884a2c43cf55a98ffb80113e47eeaf
      size: 133867389
    - path: processed/train_loader_3.pt
      md5: f2c7a97c4c2e1d86ea8c9018abacada1
      size: 11247933
    - path: processed/train_loader_4.pt
      md5: 33f7f49b9217c4f6a03f3b02555f60bc
      size: 12043325
    - path: processed/train_loader_5.pt
      md5: 23a79ef51792abeafe9f07d3ae0a7450
      size: 10426493
  train-tchs:
    cmd: python src/train_tch.py
    deps:
    - path: processed/test_loader_1.pt
      md5: 7abb6a8ffa8c6b0fe17391e6e2c88c53
      size: 3677307
    - path: processed/test_loader_2.pt
      md5: 03c425b835c1b667f828e0f00bcb20fb
      size: 71425851
    - path: processed/test_loader_3.pt
      md5: 8b5b4a699cfde5d396311b3982ceb787
      size: 14950395
    - path: processed/test_loader_4.pt
      md5: 69b275b1d21392b17ebef3d3c01d4a96
      size: 11850427
    - path: processed/test_loader_5.pt
      md5: 356190fcaf1f05d24f7b2b4ed6936236
      size: 3977915
    - path: processed/train_loader_1.pt
      md5: 41264025282d375788607e368f3b7c7e
      size: 10040509
    - path: processed/train_loader_2.pt
      md5: a3884a2c43cf55a98ffb80113e47eeaf
      size: 133867389
    - path: processed/train_loader_3.pt
      md5: f2c7a97c4c2e1d86ea8c9018abacada1
      size: 11247933
    - path: processed/train_loader_4.pt
      md5: 33f7f49b9217c4f6a03f3b02555f60bc
      size: 12043325
    - path: processed/train_loader_5.pt
      md5: 23a79ef51792abeafe9f07d3ae0a7450
      size: 10426493
    - path: src/train_tch.py
      md5: 0be3007aa65572b327b96d063cc41fbb
      size: 4242
    params:
      params.yaml:
        hardware:
          block-bits: 6
          total-bits: 64
          look-back: 9
          pred-forward: 128
          page-bits: 12
          delta-bound: 128
          split-bits: 6
          filter-size: 16
          bitmap-size: 256
          block-num-bits: 58
        model.tch_m:
          channels: 1
          dim: 1024
          depth: 24
        system:
          gpu-id: 0
          traces: ../LoadTraces/spec06
          processed: processed
          model: model
        teacher:
          number: 5
          models:
          - m
          - m
          - m
          - m
          - m
        train:
          epochs: 50
          lr: 0.0002
          gamma: 0.1
          step-size: 20
          early-stop: 10
          alpha: 0.5
          temperature: 5
    outs:
    - path: model/teacher_1.pth
      md5: 5d300a4ec964645f5dfa6e4717d5bbde
      size: 102778117
    - path: model/teacher_2.pth
      md5: 57a1e6b1010af47322e95af7acbebf3a
      size: 102778117
    - path: model/teacher_3.pth
      md5: 998d4b71b6ddff3d3e1da228e94f5357
      size: 102778117
    - path: model/teacher_4.pth
      md5: a958cdfd864a64d3db8ef0f4a6dcbf6c
      size: 102778117
    - path: model/teacher_5.pth
      md5: c80e962ea0c67b50def40c662b4705f3
      size: 102778117
    - path: res/plots/metrics/train_tch_1/test_loss.tsv
      md5: 6bb7c2529f23b76031a65c1b76a600f3
      size: 1006
    - path: res/plots/metrics/train_tch_1/train_loss.tsv
      md5: 5681d8a57edd3dcefe2f2e8b1685b6b4
      size: 1026
    - path: res/plots/metrics/train_tch_2/test_loss.tsv
      md5: 810a1ace2a743bdd861f877d5001925b
      size: 393
    - path: res/plots/metrics/train_tch_2/train_loss.tsv
      md5: 25a83e411c7abe494cc9666ecc82bdbb
      size: 401
    - path: res/plots/metrics/train_tch_3/test_loss.tsv
      md5: e0f458e2081a6395940a9e64d71c903c
      size: 1197
    - path: res/plots/metrics/train_tch_3/train_loss.tsv
      md5: f59fcb5657f30ad828e5bee9a3aac63d
      size: 1195
    - path: res/plots/metrics/train_tch_4/test_loss.tsv
      md5: d6ad5213d34fb931fdb44f525c0713ed
      size: 1148
    - path: res/plots/metrics/train_tch_4/train_loss.tsv
      md5: a1114c4eb9e5db2f7747538024a24e70
      size: 1155
    - path: res/plots/metrics/train_tch_5/test_loss.tsv
      md5: fb4807a708171ce6743bde15918d4844
      size: 1191
    - path: res/plots/metrics/train_tch_5/train_loss.tsv
      md5: 6b3dfcaedc133b7476e5b367f15b13b3
      size: 1185
  validate-tchs:
    cmd: python src/validate_tch.py
    deps:
    - path: model/teacher_1.pth
      md5: f3c8fa373bb6601e51a9c10b295577ea
      size: 13506309
    - path: model/teacher_2.pth
      md5: 24ce146b8179255c5199d30cae53236d
      size: 13506309
    - path: model/teacher_3.pth
      md5: c6c6b287b8c64ddec9587e0da0e8e69e
      size: 13506309
    - path: model/teacher_4.pth
      md5: b48631ed7ec91d77234f448328a08759
      size: 13506309
    - path: model/teacher_5.pth
      md5: 3206989e9efbc6992d179397fdadca5c
      size: 13506309
    - path: processed/df_test_1.pt
      md5: 5330d3d725bc241da0493411ecca02e7
      size: 3363635
    - path: processed/df_test_2.pt
      md5: 33cbbdf3f050f5ea45e4e770b8d7fe75
      size: 65040307
    - path: processed/df_test_3.pt
      md5: 913c8f5c196130441e59cbf369fc1166
      size: 13639923
    - path: processed/df_test_4.pt
      md5: dcf520d6ea756bc40f2f8492a19bbe59
      size: 10817459
    - path: processed/df_test_5.pt
      md5: 87926061b0daee9f3ee35a3c6f08e137
      size: 3636915
    - path: processed/test_loader_1.pt
      md5: 7abb6a8ffa8c6b0fe17391e6e2c88c53
      size: 3677307
    - path: processed/test_loader_2.pt
      md5: 03c425b835c1b667f828e0f00bcb20fb
      size: 71425851
    - path: processed/test_loader_3.pt
      md5: 8b5b4a699cfde5d396311b3982ceb787
      size: 14950395
    - path: processed/test_loader_4.pt
      md5: 69b275b1d21392b17ebef3d3c01d4a96
      size: 11850427
    - path: processed/test_loader_5.pt
      md5: 356190fcaf1f05d24f7b2b4ed6936236
      size: 3977915
    - path: src/validate_tch.py
      md5: 31c0b2fe5696708a686e6edbbe242587
      size: 6647
    params:
      params.yaml:
        apps.app: 473.astar-s1.txt.xz
        hardware:
          block-bits: 6
          total-bits: 64
          look-back: 9
          pred-forward: 128
          page-bits: 12
          delta-bound: 128
          split-bits: 6
          filter-size: 16
          bitmap-size: 256
          block-num-bits: 58
        model.tch_m:
          channels: 1
          dim: 512
          depth: 12
        system:
          gpu-id: 0
          traces: ../LoadTraces/spec06
          processed: processed
          model: model
        teacher:
          number: 5
          models:
          - m
          - m
          - m
          - m
          - m
    outs:
    - path: res/teacher_1.yaml
      md5: b22887fa32ad028fc3c1db475bce8bdf
      size: 199
    - path: res/teacher_2.yaml
      md5: bb5b4c1a101e2dd33d48aee2070382e7
      size: 197
    - path: res/teacher_3.yaml
      md5: 42884fa8fb0505a50053758bdc944811
      size: 195
    - path: res/teacher_4.yaml
      md5: 517e46ee2d4630dbea1a7e8459bfc8b0
      size: 192
    - path: res/teacher_5.yaml
      md5: 419eff96751521097aa7ea6198136018
      size: 193
  train-val-stu:
    cmd: python src/train_stu.py
    deps:
    - path: model/teacher_1.pth
      md5: f3c8fa373bb6601e51a9c10b295577ea
      size: 13506309
    - path: model/teacher_2.pth
      md5: 24ce146b8179255c5199d30cae53236d
      size: 13506309
    - path: model/teacher_3.pth
      md5: c6c6b287b8c64ddec9587e0da0e8e69e
      size: 13506309
    - path: model/teacher_4.pth
      md5: b48631ed7ec91d77234f448328a08759
      size: 13506309
    - path: model/teacher_5.pth
      md5: 3206989e9efbc6992d179397fdadca5c
      size: 13506309
    - path: processed/test_loader_1.pt
      md5: 7abb6a8ffa8c6b0fe17391e6e2c88c53
      size: 3677307
    - path: processed/test_loader_2.pt
      md5: 03c425b835c1b667f828e0f00bcb20fb
      size: 71425851
    - path: processed/test_loader_3.pt
      md5: 8b5b4a699cfde5d396311b3982ceb787
      size: 14950395
    - path: processed/test_loader_4.pt
      md5: 69b275b1d21392b17ebef3d3c01d4a96
      size: 11850427
    - path: processed/test_loader_5.pt
      md5: 356190fcaf1f05d24f7b2b4ed6936236
      size: 3977915
    - path: processed/train_loader_1.pt
      md5: 41264025282d375788607e368f3b7c7e
      size: 10040509
    - path: processed/train_loader_2.pt
      md5: a3884a2c43cf55a98ffb80113e47eeaf
      size: 133867389
    - path: processed/train_loader_3.pt
      md5: f2c7a97c4c2e1d86ea8c9018abacada1
      size: 11247933
    - path: processed/train_loader_4.pt
      md5: 33f7f49b9217c4f6a03f3b02555f60bc
      size: 12043325
    - path: processed/train_loader_5.pt
      md5: 23a79ef51792abeafe9f07d3ae0a7450
      size: 10426493
    - path: src/train_stu.py
      md5: 2eaf0ee0b2ed2bd57fc9e1ef013c4e49
      size: 6937
    params:
      params.yaml:
        hardware:
          block-bits: 6
          total-bits: 64
          look-back: 9
          pred-forward: 128
          page-bits: 12
          delta-bound: 128
          split-bits: 6
          filter-size: 16
          bitmap-size: 256
          block-num-bits: 58
        model.stu_v:
          dim: 16
          depth: 2
          heads: 2
          mlp-dim: 16
          channels: 1
        model.tch_m:
          channels: 1
          dim: 512
          depth: 12
        student:
          model: v
        system:
          gpu-id: 0
          traces: ../LoadTraces/spec06
          processed: processed
          model: model
        teacher:
          number: 5
          models:
          - m
          - m
          - m
          - m
          - m
        train:
          epochs: 50
          lr: 0.0002
          gamma: 0.1
          step-size: 20
          early-stop: 10
          alpha: 0.5
          temperature: 5
    outs:
    - path: model/student.pth
      md5: a9d103f091b9d9d7c4ae50da66b66eeb
      size: 51403
    - path: res/plots/metrics/train_stu/accuracy.tsv
      md5: 6bee2fa33176f65aaf5311cd8e775604
      size: 1140
    - path: res/plots/metrics/train_stu/accuracy_5.tsv
      md5: 4b9daf14440c23a7db3a8ca81da5fbf3
      size: 1128
    - path: res/plots/metrics/train_stu/opt_threshold.tsv
      md5: 8f174dd4af0a44fc1e737b0678a335e5
      size: 700
    - path: res/plots/metrics/train_stu/precision.tsv
      md5: 38de8af56a7ef6662e3363e38a46f8aa
      size: 1114
    - path: res/plots/metrics/train_stu/precision_5.tsv
      md5: 4c388934d60e5d4c0861572ae8244fc1
      size: 1129
    - path: res/plots/metrics/train_stu/recall.tsv
      md5: e781562bb45e04db1a4de9b635e072e4
      size: 1128
    - path: res/plots/metrics/train_stu/recall_5.tsv
      md5: ad9821a729bfd2f3cb5af38e9ecf42b9
      size: 1151
    - path: res/plots/metrics/train_stu/test_loss_1.tsv
      md5: e08eb56c38a22410a4032d6288f3bc06
      size: 1162
    - path: res/plots/metrics/train_stu/test_loss_2.tsv
      md5: bbdfffdc6b831499462de665d371edcb
      size: 1163
    - path: res/plots/metrics/train_stu/test_loss_3.tsv
      md5: b6048309cc083d9c6245770e7aef48a9
      size: 1174
    - path: res/plots/metrics/train_stu/test_loss_4.tsv
      md5: b4fad26981e9ec439041b1e6f87ce913
      size: 1171
    - path: res/plots/metrics/train_stu/test_loss_5.tsv
      md5: dd04ab09f5eb99ff0f5f77f79f0136e2
      size: 1160
    - path: res/plots/metrics/train_stu/train_loss_1.tsv
      md5: 330444f5867a78708cac511ed44af58f
      size: 1187
    - path: res/plots/metrics/train_stu/train_loss_2.tsv
      md5: 903d3de5f8b7ffa16d1e993c240bd760
      size: 1187
    - path: res/plots/metrics/train_stu/train_loss_3.tsv
      md5: 49290379a8a8ca3be0c0f6963d790987
      size: 1180
    - path: res/plots/metrics/train_stu/train_loss_4.tsv
      md5: 47403fccd7e04e4b48b2d42b225e3ca1
      size: 1192
    - path: res/plots/metrics/train_stu/train_loss_5.tsv
      md5: 9eff05de7d9d28ebd5f86195a5e6a377
      size: 1185
